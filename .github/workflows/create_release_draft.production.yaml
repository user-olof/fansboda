name: 5. Create Release Draft in Production
run-name: ${{ github.actor }} is creating a release draft in Production  ðŸš€

on:
  workflow_dispatch:


jobs:
  create_release_draft:
    runs-on: ubuntu-latest
    environment: prod
    

    steps:
      - name: Checkout
        uses: actions/checkout@v4
    
    # get the latest release tag
      - name: Get Latest Release Tag
        run: |
          git fetch --tags
          LATEST_TAG=$(git tag -l --sort=-version:refname | head -n 1)
          echo "LATEST_TAG=$LATEST_TAG" >> $GITHUB_OUTPUT
      
    # increase the latest tag by 0.0.1. If the patch version is 9, increment the minor version and set the patch version to 0.
      - name: Increase Latest Tag
        run: |
          PATCH_VERSION=$(echo $LATEST_TAG | awk -F. '{ print $3 }')
          if [ "$PATCH_VERSION" -eq 9 ]; then
            MINOR_VERSION=$(echo $LATEST_TAG | awk -F. '{ print $2 }')
            echo "$MAJOR_VERSION.$((MINOR_VERSION + 1)).0"
          else
            echo "$LATEST_TAG"
          fi
          echo "LATEST_TAG=$LATEST_TAG" >> $GITHUB_OUTPUT

    # create release draft using the scripts/create-release.sh script
      - name: Create Release Draft
        run: |
          ./scripts/create-release.sh $LATEST_TAG