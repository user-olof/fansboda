name: Deploy to Cloud Run
run-name: ${{ github.actor }} is deploying to Cloud Run  ðŸš€
on: 
  workflow_run:
      workflows: ["Build and Test"] # Run the deploy after successful Build and Test
      types:
        - completed     

jobs:
  deploy_to_cloud_run:
    runs-on: ubuntu-latest

    env:
      GOOGLE_APPLICATION_CREDENTIALS: "NONE"
 
    steps:
    - uses: actions/checkout@v4

    # Creates a credentials file that will be used for ADC later
    - name: Create credentials file
      run: |
        echo "${{ secrets.GCP_SVC_ACCOUNT_CREDS }}" | base64 --decode > $GOOGLE_APPLICATION_CREDENTIALS  
        echo "Checking credentials"
        head -n 3 "$GOOGLE_APPLICATION_CREDENTIALS"
    
    - name: Authenticate with Google Cloud
      uses: google-github-actions/auth@v1
      with:
        credentials_json: $GOOGLE_APPLICATION_CREDENTIALS
      

   
     
